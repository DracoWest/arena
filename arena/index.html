<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dracowest | Monster Arena Checklist</title>

<style>
:root{
  --bg0:#06070a;--bg1:#0b0f16;--gold:#b99a61;
  --text:#d9e6ff;--muted:#9bb0d6;--danger:#ff6b6b;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Georgia,serif;
  background:linear-gradient(180deg,var(--bg1),var(--bg0));
  color:var(--text);
  padding:28px 18px;
}
.wrap{max-width:1100px;margin:auto}
.header{
  display:flex;justify-content:space-between;align-items:flex-end;
  background:#0f1726;border-radius:16px;padding:18px;
}
.title{color:var(--gold);letter-spacing:.08em;margin:0}
.sub{font-size:13px;color:var(--muted)}

.controls{
  display:flex;justify-content:space-between;flex-wrap:wrap;
  margin:14px 0;gap:10px
}
input,select{
  background:#0c1220;color:var(--text);
  border:1px solid #ffffff18;border-radius:12px;
  padding:10px 12px;min-width:220px
}
.btn{
  background:#1a263d;color:var(--text);
  border:1px solid #ffffff18;border-radius:12px;
  padding:10px 14px;font-weight:600;cursor:pointer
}
.btn.gold{background:#c3a46a;color:#0b0f16}

.panel{background:#0b1322;border-radius:16px;overflow:hidden}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:10px;border-bottom:1px solid #ffffff10}
th{color:var(--gold);text-transform:uppercase;font-size:12px}
td.lock{color:#d6e4ff}

td.tally{width:140px}
.tallyControls{display:flex;justify-content:flex-end;gap:8px}
.tallyBtn{
  width:34px;height:34px;border-radius:10px;
  border:1px solid #ffffff18;background:#1a263d;
  color:var(--text);font-weight:800;cursor:pointer
}
.tallyBtn.plus{background:#c3a46a;color:#0b0f16}
.tallyInput{
  width:52px;text-align:center;font-weight:700;
  background:#0f1a2f;color:var(--text);
  border:1px solid #ffffff18;border-radius:10px
}

.status{margin-top:10px;font-size:12px;color:var(--muted)}
.status.bad{color:var(--danger)}
</style>
</head>

<body>
<div class="wrap">
  <div class="header">
    <div>
      <h1 class="title">Monster Arena Checklist</h1>
      <div class="sub">Editable: Tally only</div>
    </div>
    <div>
      <span id="countPill">Loading…</span>
      <button class="btn" id="refreshBtn">Refresh</button>
      <button class="btn gold" id="saveAllBtn">Save All</button>
    </div>
  </div>

  <div class="controls">
    <div>
      <input id="search" placeholder="Search monsters, areas, types…" />
      <select id="areaFilter"><option value="">All areas</option></select>
    </div>
    <div>
      <button class="btn" id="zeroVisibleBtn">Zero visible</button>
    </div>
  </div>

  <div class="panel">
    <table>
      <thead>
        <tr>
          <th>Area</th>
          <th>Monster</th>
          <th>Type</th>
          <th>Location</th>
          <th>Tally</th>
        </tr>
      </thead>
      <tbody>
        <!-- KEEP ALL YOUR EXISTING ROWS -->
        <!-- Only change the LAST <td> to class="tally" -->
      </tbody>
    </table>
  </div>

  <div class="status" id="status"></div>
</div>

<script>
const STATUS=document.getElementById('status');
const COUNT=document.getElementById('countPill');
const pending=new Map();

function setStatus(t,b=false){STATUS.textContent=t;STATUS.className=b?'status bad':'status'}
function visibleRows(){return [...document.querySelectorAll('tbody tr')].filter(r=>r.style.display!=='none')}
function updateCount(){COUNT.textContent=`${visibleRows().length} / ${document.querySelectorAll('tbody tr').length} shown`}

function applyFilters(){
  const q=search.value.toLowerCase(),a=areaFilter.value;
  document.querySelectorAll('tbody tr').forEach(tr=>{
    const text=[...tr.querySelectorAll('td.lock')].map(td=>td.textContent).join(' ').toLowerCase();
    tr.style.display=(!q||text.includes(q))&&(!a||tr.dataset.area===a)?'':'none';
  });
  updateCount();
}

search.oninput=applyFilters;
areaFilter.onchange=applyFilters;

(function initAreas(){
  [...new Set([...document.querySelectorAll('tbody tr')].map(tr=>tr.dataset.area))]
  .sort().forEach(a=>areaFilter.add(new Option(a,a)));
  updateCount();
})();

function upgradeTallies(){
  document.querySelectorAll('td.tally').forEach(td=>{
    if(td.querySelector('.tallyControls'))return;
    td.innerHTML=`
      <div class="tallyControls">
        <button class="tallyBtn minus">−</button>
        <input class="tallyInput" value="0"/>
        <button class="tallyBtn plus">+</button>
      </div>`;
  });
}

document.addEventListener('click',e=>{
  const btn=e.target.closest('.tallyBtn');
  if(!btn)return;
  const input=btn.closest('.tallyControls').querySelector('.tallyInput');
  let v=Number(input.value)||0;
  if(btn.classList.contains('plus'))v++;
  if(btn.classList.contains('minus'))v=Math.max(0,v-1);
  input.value=v;
});

upgradeTallies();
</script>
</body>
</html>
